{% extends "layout.html" %}

{% block title %}
    List of students
{% endblock title %}


{% block content %}

    <script>
		$(document).ready(function(){
  		 	$(".active").removeClass("active");
  		 	$("#student").addClass("active");
		});
	</script>

    <style>
        .grade-link {
            color:black;
        }
        .grade-link:hover {
            color:black;
            text-decoration: none;
        }
        #live-search-box{
           text-align:center;
        }
        #customFile .custom-file-control:lang(en)::after {
        content: "Select file...";
        }

        #customFile .custom-file-control:lang(en)::before {
          content: "Click me";
        }

    </style>

    <div class="container" style="margin-top:70px;">
        <div class="row d-flex justify-content-center">
            <h1>Študenti</h1>
        </div>
    </div>

    <div class="container" style="margin-top:30px;">
        <div class="row d-flex justify-content-center">
            <form class="form-inline my-2 my-lg-0">
              <input class="form-control mr-sm-2" id="live-search-box" type="search" placeholder="Vyhľadať študentov" aria-label="Search">
            </form>
        </div>
    </div>

    <div class="container" style="padding-top:40px;">
        <div class="row d-flex justify-content-center">
            {% for grade in grades %}
                <a href="{{ url_for('student_bp.landing_page_grade',grade=grade.name) }}" class="grade-link">
                    <div class="card center" style="margin:10px;">
                      <div class="card-body">
                        {{ grade.name }}
                      </div>
                    </div>
                </a>
            {% endfor %}
            <a href="{{ url_for('student_bp.landing_page') }}" class="grade-link">
                <div class="card center" style="margin:10px;">
                  <div class="card-body">
                    Všetci
                  </div>
                </div>
            </a>
        </div>
    </div>


    <div style="margin:30px;" class="d-flex justify-content-center">
			<div class="collapse " id="collapseExample2">
			  <div class="card card-body ">
                <strong class="" style="padding-bottom:5px;font-size: 18px;">Nový študent</strong>
			    <form class="form-inline needs-validation" action="{{url_for('student_bp.new_student')}}" method="post" style="margin-top:10px;">
				  <input name="student_name"  type="text" class="form-control mb-2 mr-sm-2" id="validationCustom01" placeholder="Meno">
                  <input name="student_code"  type="number" class="form-control mb-2 mr-sm-2"  placeholder="Kód">
                    <select class="form-control" name="grade" style="margin-right:10px;margin-bottom:10px;" required>
                      {% for grade in grades %}
                        <option>{{ grade.name }}</option>
                      {% endfor %}
                    </select>
                  <button type="submit" class="btn btn-primary mb-2">Pridať</button>
				</form>
			  </div>
			</div>

		</div>
        <div style="margin:30px;" class="d-flex justify-content-center">
			<div class="collapse " id="add-m-student">
			  <div class="card card-body ">
                <strong class="" style="padding-bottom:5px;font-size: 18px;">Načítať študentov z Excelu</strong>
			    <form class="needs-validation" action="{{url_for('student_bp.upload_file')}}" enctype="multipart/form-data" method="post" style="margin-top:10px;">
				  <div class="custom-file">
                    <input type="file" name="file" class="custom-file-input" id="customFile" required>
                    <label class="custom-file-label" for="customFile">Vyber súbor</label>
                  </div>

                  <button style="margin-top:10px;" type="submit" class="btn btn-primary mb-2">Načítať</button>
				</form>
			  </div>
			</div>

		</div>


        <div class="modal fade" id="ar_u_s" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Naozaj ?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Keď sa všetci študenti pohnú o jeden ročník vyšie, žiaci v triedach Oktáva, 4.A a 4.B sa automaticky vymažú.
              </div>
              <div class="modal-footer">
                <a type="button" href="{{ url_for('student_bp.move_all_s_up') }}" class="btn btn-primary">Ok</a>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Zavrieť</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="ar_u_s_2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Naozaj ?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                Keď sa všetci študenti pohnú o ročník nižšie, žiaci v triedach Príma, 1.A a 1.B sa vymažu automaticky.
              </div>
              <div class="modal-footer">
                <a type="button" href="{{ url_for('student_bp.move_all_s_down') }}" class="btn btn-primary">Ok</a>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Zavrieť</button>
              </div>
            </div>
          </div>
        </div>

            <div class="d-flex justify-content-center" style="margin-top:20px;">
                <button id="add-student" class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample2" aria-expanded="false" aria-controls="collapseExample2">
		        + Pridať študenta
		      </button>
              <button id="add-m-student-b" style="margin-left:10px;" class="btn btn-primary" type="button" data-toggle="collapse" data-target="#add-m-student" aria-expanded="false" aria-controls="add-m-student">
		        + Načítať z Excelu
		      </button>
            </div>

            <div class="d-flex justify-content-center" style="margin-top:20px;">

		      <button class="btn btn-success" type="button"  data-toggle="modal" data-target="#ar_u_s">
		        Zdvihnúť všetkých študentov
		      </button>
              <button class="btn btn-secondary" type="button" style="margin-left:10px;" data-toggle="modal" data-target="#ar_u_s_2">
		        Znížiť všetkých študentov
		      </button>
		    </div>




    <div class="container" style="padding-top:60px;">
        <table class="table" id="students-table">
          <thead class="thead-dark">
            <tr class="header">
              <th scope="col">#</th>
              <th scope="col">Meno</th>
              <th scope="col">Kód</th>
              <th scope="col">Trieda</th>
              <th scope="col">Všetky knihy</th>
              <th scope="col">Vidieť</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
                <tr>
                  <th scope="row">{{ student.id }}</th>
                  <td>{{ student.name }}</td>
                  <td>{{ student.code }}</td>
                  <td>{{ student.grade.name }}</td>
                  <td>{{ student.books|length }}</td>
                  <td><a class="btn btn-primary btn-sm " href="{{url_for('student_bp.view_student',student_id=student.id)}}">Vidieť</a></td>
                </tr>
            {% endfor %}

          </tbody>
        </table>

    </div>

    <script>

        $(document).ready(function(){
          $("#live-search-box").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#students-table tr:not(.header)").filter(function() {
              $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
          });
        });

         $(document).ready(function(){
	     $('#add-student').on('click', function () {
	      var text=$('#add-student').text();
	      if(text === "- Pridať študenta"){
	        $(this).html('+ Pridať študenta');
	      } else{
	        $(this).text('- Pridať študenta');
	     }
	    });
	    });

	    $(document).ready(function(){
	     $('#add-m-student-b').on('click', function () {
	      var text=$('#add-m-student-b').text();
	      if(text === "- Načítať z Excelu"){
	        $(this).html('+ Načítať z Excelu');
	      } else{
	        $(this).text('- Načítať z Excelu');
	     }
	    });
	    });

	    document.querySelector('.custom-file-input').addEventListener('change',function(e){
          var fileName = document.getElementById("exampleInputFile").files[0].name;
          var nextSibling = e.target.nextElementSibling
          nextSibling.innerText = fileName
        });
    </script>

{% endblock content %}